<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Mobile触摸页面</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="../css/font/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="../css/mobileui.css" />
    <style>
        .m-cnt {
            width:100%;
            display: flex;
            flex-flow:nowrap  row;

        }

        .m-cnt-l {
            flex: 0 0 3.5rem;
            height: 100%;
            border-right: 1px solid #ddd;
        }

        .m-cnt-r {
            flex: 1 1;
            height:100%;
          
        }

      
        .m-overflow-tb-cnt {
            padding: 0 .5rem;
        }
        .m-overflow-tb-cnt p {
            padding:2px;  
            text-overflow: ellipsis;
            overflow: hidden;
            white-space:nowrap;
            font-size: .8rem;
            line-height:2rem;
        }
    </style>

</head>

<body>
    <!--主体-->
    <div class="m-bd ">

        <!--头部-->
        <header class="m-hd">
            <div class="m-hd-top">

                <div class="m-hd-top-icon  m-back">
                    <span class="iconfont icon-back-left "></span>
                </div>

                <h4 class="m-hd-top-ttl" id="ttl">touch上下nav滑动</h4>
            </div>

        </header>

        <!--内容-->
        <section class="m-cnt">
            <div class="m-cnt-l">
                <nav class="m-touch-nav-tb">
                    <ul class="m-touch-nav-tb-cnt ">
                        <li class="active  m-touch-nav-item">
                            <a href="javascript:;">center</a>
                        </li>
                       
                    </ul>
                </nav>

            </div>
            
            <div class="m-cnt-r">
                <div class="m-touch-nav-tb-item">
                    <div class="m-overflow-tb" data-toggle="m-overflow-tb">
                        <div class="m-overflow-tb-cnt">

                        </div>
                        <div class="m-overflow-tb-loading">
                            正在加载中...
                        </div>

                    </div>
                </div>

            </div>
        </section>

    </div>

    <script src="../js/mobileui.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">

        m(function () {

            // 加载nav 和tab
            var nav = "";
            var tab = "";
         
            for (var i = 0; i < 40; i++) {
                nav += `<li class="${i === 0 ? `active` : ``}  m-touch-nav-item" data-tab="#tab${i + 1}">
                            <a href="javascript:;">第 ${i + 1} 屏</a>
                        </li>  `;

                tab += ` <div class="m-touch-nav-tb-item ${i === 0 ? `active` : ``}"  id="tab${i + 1}">
                            <div class="m-overflow-tb"  >
                                <div class="m-overflow-tb-cnt">

                                </div>
                                <div class="m-overflow-tb-loading">
                                      正在加载中...
                                </div>

                            </div>

                        </div>  `;

            }
             
            // 触发插件
            m(".m-touch-nav-tb-cnt").html(nav).parent().mTouchNavTb();
            m(".m-cnt-r").html(tab)
            m(".m-overflow-tb").mOverflowTb();

           
             // tap.m.touch.nav.tb触发的事件
            m(".m-touch-nav-tb").on("tap.m.touch.nav.tb", function (event, el, moveY) {

                var id = m(el).attr("data-tab");
                m(id).addClass("active").siblings().removeClass("active");
                
                if (!m(id).data("isOne")) {
                     m(id).data("isOne", true);
                   ajaxData(m(id), m(id).index());
                }
            });

           
            // 拉到底部触发
            m(".m-overflow-tb").on("reachbottom.m.overflow.tb", function (event, el, scrollObj) {

                var $el = m(el).parents(".m-touch-nav-tb-item");
                ajaxData($el, $el.index());

            });

               // 第一次加载数据
            var $activeEl = $(".m-touch-nav-tb-item.active");
            ajaxData($activeEl, 0);
            $activeEl.data("isOne", true);

            // ajax 加载数据
            function ajaxData($el, index) {

                if ($el.data("loadingEnd")) {
                    return;
                }
                $el.data("loadingEnd", true);

                m.get("../json/tab.json", function (res) {

                    $el.data("loadingEnd", false);
                    var page = $el.data("pageindex") || 1;
                    var docf = document.createDocumentFragment();
                    for (var i = 0; i < res.length; i++) {

                        var p = document.createElement("p");
                        p.classList.add("elp-1");
                        p.innerHTML = (index + 1) + "屏==" + page + "页==" + res[i].content;
                        docf.appendChild(p);
                    }
                    $el.data("pageindex", ++page);
                    $el.find(".m-overflow-tb-cnt").append(docf);
                }, "json");

            }


        });

    </script>

</body>

</html>
