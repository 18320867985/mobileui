<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Mobile触摸页面</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="../css/font/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="../css/mobileui.css" />
    <style>

        .m-touch-tb {
            height: 100%;
        }

        .m-overflow-tb-cnt {
            padding: .25rem .5rem;
        }

            .m-overflow-tb-cnt p {
                padding: .5rem .2rem;
                text-overflow: ellipsis;
                overflow: hidden;
                white-space: nowrap;
                font-size: .8rem;
            }
    </style>

</head>

<body>
    <!--主体-->
    <div class="m-bd m-touch-df">

        <!--头部-->
        <header class="m-hd">
            <div class="m-hd-top">
                <div class="m-hd-top-icon  m-back">
                    <span class="iconfont icon-back-left "></span>
                </div>

                <h4 class="m-hd-top-ttl">tab滑动组件分页</h4>
            </div>

        </header>

        <!--内容-->
        <section class="m-cnt">

            <div class="m-touch-tab">
                <div class="m-touch-tab-cnt">

                    <!--滑动的内容 m-touch-lr-item是m-touch-lr的宽度 -->
                    <div class="m-touch-tab-item active">
                        <div class="m-overflow-tb">
                            <div class="m-overflow-tb-cnt">

                            </div>
                            <div class="m-overflow-tb-loading">
                                正在加载中...
                            </div>
                        </div>

                    </div>

                </div>
            </div>

        </section>


        <p class="p"></p>
        <p class="p"></p>

    </div>

    <script src="../js/mobileui.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">

        m(function () {


            // 触发插件
            m(".m-touch-tab-cnt").parent().mTouchTab();
            m(".m-overflow-tb").mOverflowTb();


         
            // tab 触发自定义的事件
            m(".m-touch-tab").on("tab.m.touch.tab", function (event, el, index) {

                if (!m(el).attr("data-one")) {   // 动态加载tab 《项不能用data,而用attr实现 》
                    m(el).attr("data-one", true)
                    ajaxData(el, index);
                }
            });

            // 第一次加载数据
            var $activeEl = $(".m-touch-tab-item.active");
            ajaxData($activeEl, 0);
            $activeEl.attr("data-one", true); // 动态加载tab 《项不能用data,而用attr实现 》


            // ajax 加载数据
          
            var indexPage = 1;
            function newTab(index) {
                var tabWidth = m(".m-touch-tab").outerWidth();
                var tab = ` <div class="m-touch-tab-item" style="width:${tabWidth}px" id="page_${index}">
                                    <div class="m-overflow-tb">
                                        <div class="m-overflow-tb-cnt">

                                        </div>
                                     <div class="m-overflow-tb-loading">
                                        正在加载中...
                                    </div>

                                    </div>

                                </div>  `;

                return tab;

            }
            function ajaxData($el, index) {

                m.get("../json/tab.json", function (res) {

                    var page = indexPage++;
                    var docf = document.createDocumentFragment();
                    for (var i = 0; i < res.length; i++) {

                        var p = document.createElement("p");
                        p.innerHTML = page + "页==" + res[i].content;
                        docf.appendChild(p);
                    }
                    $el.find(".m-overflow-tb-cnt").append(docf);
                    $el.find(".m-overflow-tb-loading").hide(); // 隐藏加载动画的元素

                    //  加载下一页元素
                    m(".m-touch-tab-cnt").append(newTab(page));


                }, "json");

            }


        });


    </script>

</body>

</html>
