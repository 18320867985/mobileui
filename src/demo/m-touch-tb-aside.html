<!-- 1. css  style  区域 -->
<style>
    #m-aside {
        width: 100%;
        display: flex;
        flex-flow: nowrap row;
    }
    #m-aside .m-cnt-l {
        flex: 0 0 3.5rem;
        height: 100%;
        border-right: 1px solid #ddd;
    }
    #m-aside .m-cnt-r {
        flex: 1 1;
        height: 100%;
    }
    #m-aside .m-lazy {
        min-height:7rem;
    }
</style>

<!--2.内容区域 -->
<section class="m-router-cnt" id="m-aside">

    <!--左边菜单 上下touch-tb滑动区-->
    <div class="m-cnt-l">
        <nav class="m-touch-tb">
            <ul class="m-touch-tb-cnt ">
                <li class="active  m-touch-tb-item">
                   
                </li>

            </ul>
        </nav>
    </div>

    <!--右边内容区域-->
    <div class="m-cnt-r">

        <div class="m-aside-r-box">
            <!--上下overfolw 滑动区-->
            <div class="m-overflow-tb" >
                <div class="m-overflow-tb-cnt">

                    <!--两列高度自动 -->
                    <div class="m-media-auto">

                        <ul class="m-media-list m-media-auto-l">

                            <li class="m-media">
                                <a data-link href="./demo/m-card.html?ttl=列表详情">
                                    <img class="m-media-img" src="./images/shop-1.webp">

                                    <div class="m-media-body">
                                        <h5 class="m-media-title  elp-2">雅鹿自由自在 21年连衣裙2021年季女装新款装新品气质典雅减龄大码显瘦裙子女 9306 七分袖 M</h5>

                                        <p class="m-media-text elp-4">裙子款式好看，摸着舒适，当晚洗后没有发现掉色的现象，</p>

                                        <div class="m-media-icon">
                                            <div class="m-media-icon-l"><span>￥</span> <span>288</span></div>

                                            <div class="m-media-icon-r"><span>看相似的</span></div>
                                        </div>

                                    </div>


                                </a>
                            </li>

                        </ul>

                        <ul class="m-media-list m-media-auto-r">

                            <li class="m-media">
                                <a data-link href="./demo/m-card.html?ttl=列表详情">
                                    <img class="m-media-img" src="./images/shop-5.webp">

                                    <div class="m-media-body">
                                        <h5 class="m-media-title  elp-2">雅鹿自由自在 21年连衣裙2021年季女装新款装新品气质典雅减龄大码显瘦裙子女 9306 七分袖 M</h5>

                                        <p class="m-media-text elp-4">裙子款式好看，摸着舒适</p>

                                        <div class="m-media-icon">
                                            <div class="m-media-icon-l"><span>￥</span> <span>288</span></div>

                                            <div class="m-media-icon-r"><span>看相似的</span></div>
                                        </div>

                                    </div>


                                </a>
                            </li>

                        </ul>

                    </div>
                </div>
                <div class="m-overflow-tb-loading">
                    正在加载中...
                </div>

            </div>
        </div>

    </div>
</section>

<!-- js 区域 -->
<script type="text/javascript">

    /* 路由页面监听事件对象 */
    m.router.page({

        /* 设置当前路由页面的对象的参数 */
        setting: {
            routerTilte: "touch-tb 侧边上下滑动菜单", // 路由页的标题
            // routerTilteColor: "red",  // 路由页的标题字体颜色
            // routerClass:"router-class-1"   // 路由页的class
        },

        /*加载js的列表 */
        loadJs: [
           
        ],
        
        // 生命周期函数--监听页面加载完成
        onLoad: function (context, parameter) {

            // context 当前路由模块上下文对象
            //console.log("onLoad:", context);

            // context 当前路由模块接受的参数
            //console.log("parameter:", parameter);

            // 加载nav 和tab
            var nav = "";
            var tab = "";
            var navs = ["京东超市", "数码电器", "京东美食", "京东商城", "京东服饰", "京东生鲜", "京东到家", "充值缴费", "领券", "领金贴", "手机", "家居厨具", "京东美食", "美妆护肤", "男装", "女装", "内衣配饰", "数码", "珠宝", "医药保健", "箱包", "玩具乐器", "汽摩生活", "二手商品", "计生情趣", "生活旅游", "图书文娱", "京东服务", "拍卖", "工业品", "宠物鲜花", "PLUS会员"];
            for (var i = 0; i < navs.length; i++) {
                nav += `<li class="${i === 0 ? `active` : ``}  m-touch-tb-item" data-tab="#tab${i + 1}">
                                    <a href="javascript:;">${navs[i]} </a>
                                </li>  `;

                tab += ` <div class="m-aside-r-box ${i === 0 ? `active` : ``}"  id="tab${i + 1}" data-ttl="${navs[i]}">
                                    <div class="m-overflow-tb"  >
                                        <div class="m-overflow-tb-cnt">
                                              <!--两列高度自动 -->
                                            <div class="m-media-auto">

                                                <ul class="m-media-list m-media-auto-l">

                                                </ul>

                                                <ul class="m-media-list m-media-auto-r">

                                                </ul>

                                            </div>

                                        </div>
                                        <div class="m-overflow-tb-loading">
                                              正在加载中...
                                        </div>

                                    </div>

                                </div>  `;

            }

        
            // 触发插件
            // 1.插件模式 m.mTouchNavTb()  2.组件模式< data-toggle="m-touch-nav-tb">

            // touch-tb 上下滑动组件
            m(".m-touch-tb-cnt", context).html(nav).parent().mTouchTb({
                //top: true,                // 菜单 m-touch-tb-item 定位顶部 ,默认定位中间
                //limitTop: true,       // 禁止顶部下拉 默认为false
                //limitBottom: true ,  // 禁止底部下拉  默认为false
                //limit: 0.4,         //弹性拉动空间   默认为相对方向宽或高的值 默认为1/2
            });

            m(".m-cnt-r", context).html(tab)

            // overflow 上下滑动组件
            m(".m-overflow-tb", context).mOverflowTb();


            // tap.m.touch.nav.tb触发的事件
            m(".m-touch-tb", context).on("tap.m.touch.tb", function (event, el, moveY) {

                var id = m(el).attr("data-tab");
                m(id).addClass("active").siblings().removeClass("active");

                if (!m(id).data("isOne")) {
                    m(id).data("isOne", true);
                    ajaxData(m(id), m(id).index());
                }
            });


            // 拉到底部触发
            m(".m-overflow-tb", context).on("reachbottom.m.overflow.tb", function (event, el, scrollObj) {

                var $el = m(el).parents(".m-aside-r-box");
                ajaxData($el, $el.index());

            });

            // 第一次加载数据
            var $activeEl = $(".m-aside-r-box.active", context);
            ajaxData($activeEl, 0);
            $activeEl.data("isOne", true);

            // ajax 加载数据
            function ajaxData($el, index) {

                if ($el.data("loadingEnd")) {
                    return;
                }
                $el.data("loadingEnd", true);
                var ttl = $el.attr("data-ttl");

                m.get("./json/tab.json", function (res) {

                    $el.data("loadingEnd", false);
                    var page = $el.data("pageindex") || 1;
                    // var docf = document.createDocumentFragment();
                   
                     // 左右边轮动添加
                    var $el_l = $el.find(".m-overflow-tb-cnt .m-media-auto-l");
                    var $el_r = $el.find(".m-overflow-tb-cnt .m-media-auto-r");

                    for (var i = 0; i < res.length; i++) {

                        var li = `  <li class="m-media">
                                    <a data-link href="./demo/m-card.html?ttl=${ttl}&&img=${res[i].img}">

                                      <div class="m-lazy m-lazy-mask"  title="JD京东">
                                        <img class="m-media-img m-lazy-img"  data-lazy="./${res[i].img}">
                                      </div>

                                        <div class="m-media-body">
                                            <h5 class="m-media-title elp-1 ">${ttl}</h5>

                                            <p class="m-media-text elp-4">${res[i].content}</p>

                                            <div class="m-media-icon">
                                                <div class="m-media-icon-l"><span>￥</span> <span>288</span></div>

                                                <div class="m-media-icon-r"><span>看相似的</span></div>
                                            </div>

                                        </div>
                                    </a>
                                </li>`;

                        var $el_l_h = $el_l.height();
                        var $el_r_h = $el_r.height();

                        if ($el_l_h < $el_r_h) {
                            $el.find(".m-overflow-tb-cnt .m-media-auto-l").append(li);

                        } else {
                            $el.find(".m-overflow-tb-cnt .m-media-auto-r").append(li);
                        }  
                    }

                    $el.data("pageindex", ++page);
                   // $el.find(".m-overflow-tb-cnt .m-media-auto-l").append(lis_l);
                    //$el.find(".m-overflow-tb-cnt .m-media-auto-r").append(lis_r);

                    // 执行延迟加载
                    var $aciveEl = m(".m-aside-r-box.active", context);
                    if (!$aciveEl.hasAttr("lazy-runing")) {
                        $aciveEl.attr("lazy-runing", true);
                        $aciveEl.find(".m-overflow-tb").mLazy("init"); //初始化 执行延迟加载
                    }

                }, "json");

            }

        },

        // 生命周期函数--监听页面显示
        onShow: function (context) {
            // context 当前路由模块上下文对
            //console.log("onShow", context);
        },

        // 生命周期函数--监听页面隐藏
        onHide: function (context) {
            // context 当前路由模块上下文对
            // console.log("onHide", context);

        },

    });

</script>


