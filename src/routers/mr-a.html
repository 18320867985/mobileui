
<style>

    .m-btn.m-btn-block {
        margin-top: 1.5rem;
    }

    .m-alert .m-alert-cnt-ttl > ._txt {
        color: #d9534f;
    }

    .vd-dep-btn.vd-error {
        color: #999;
    }
</style>

<section class="m-router-cnt">
    <div class="m-overflow-tb">
        <div class="m-overflow-tb-cnt">
            <div class="m-input-group " id="form1">

                <!-- 1步 class="vd-box" -->
                <div class="m-input vd-box">
                    <label class="m-input-label">用户名</label>

                    <!-- 2步 class="vd-item" -->
                    <!-- 3步 name="email" 做为提交数据的对象的属性名 -->
                    <!-- 4步 [vd-pattern， v-req,vd-pattern,vd-remote,等等，详细请参考vd.帮助文档] -->
                    <input class="m-input-box vd-item" type="text" vd-req vd-req-msg="用户名不能为空" name="user" maxlength="32" value="" placeholder="输入用户名" />

                </div>
                <div class="m-input vd-box">
                    <label class="m-input-label">密码</label>
                    <input class="m-input-box vd-item" type="text" name="pwd" vd-req vd-req-msg="密码不能为空" vd-compare-emit="pwd2" vd-pattern="^\S{8,32}$" vd-pattern-msg="密码长度8到32位" placeholder="输入密码" />
                </div>

                <div class="m-input vd-box">
                    <label class="m-input-label">确认密码</label>
                    <input class="m-input-box vd-item" type="text" name="pwd2" vd-req vd-req-msg="确认密码不能为空" vd-compare="pwd" vd-compare-msg="两次密码不相同" placeholder="输入密码" />
                </div>



                <div class="m-input vd-box">
                    <label class="m-input-label">手机号码</label>
                    <input class="m-input-box vd-item" type="text" name="phone" vd-req vd-req-msg="手机号码不能为空" vd-pattern="^1\d{10}$"
                           vd-pattern-msg="手机格式不对" maxlength="11" vd-remote="../js/m-vd.json" vd-remote-msg="手机号码已存在" placeholder="输入手机号码" />
                    <!-- vd-dep-btn -->
                    <button type="button" class="m-input-btn vd-dep-btn" href="">发送</button>

                </div>

                <div class="m-input vd-box">
                    <label class="m-input-label">验证码</label>
                    <input class="m-input-box vd-item" type="text" vd-req vd-req-msg="验证码不能为空" vd-remote="../js/m-vd.json"
                           vd-remote-length="6" vd-remote-msg="验证码不对" name="yzm" maxlength="6" value="" placeholder="输入验证码" />

                </div>

                <div class="m-input  vd-box">
                    <label class="m-input-label">邮箱</label>
                    <input class="m-input-box  vd-item" type="text" name="email"
                           vd-req vd-req-msg="邮箱不能为空" vd-pattern="^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$" vd-pattern-msg="收件人格式不对" value=""
                           placeholder="输入邮箱" />
                </div>

                <div class="m-input  vd-box">
                    <label class="m-input-label">所在省份</label>
                    <input class="m-input-box  vd-item" type="text" name="city" id="city"
                           vd-req vd-req-msg="省份不能为空"
                           placeholder="选择省份" />
                </div>


            </div>
            <!-- vd-btn 提交按钮-->
            <button type="button" class="m-btn m-btn-success  m-btn-block vd-btn">提交</button>
            <button type="button" class="m-btn m-btn-primary  " id="router">路由加载html页</button>
        </div>
    </div>
</section>

<script type="text/javascript">

        m.router.app  // 全局对象 此对象只能添加属性 不能覆盖;
        m.router.app.page = m.router.app.page || 0;
        m.router.app.page= ++m.router.app.page;
        /*
             * 监听路由页面加载
             * */
        m.router.page({

                /* 设置当前路由页面的对象的参数 */
                 setting: {
                    routerTilte: "测试路由"+ m.router.app.page, // 路由页的标题
                    // routerTilteColor: "red",  // 路由页的标题字体颜色
                },

                /*加载js的列表 */
                loadJs: [
                    "../js/m-vd.js",
                    "../js/cityData.js"
                 ],
                // isAmd:true, /*默认为true异步加载js, isAmd=false同步加载js*/   

                // 生命周期函数--监听页面显示
            onLoad: function (context, parameter) {

                     // context 当前路由模块上下文对象
                    console.log("onLoad:", context);

                    // context 当前路由模块接受的参数
                    console.log("parameter:", parameter);   

                    var vd1 = m.vd.create("#form1", context);
                    // 始化验证对象
                    vd1.init();
                    //vd1.reset();  //重设表单并清空所以内容和检测验证

                    // 检查验证=>vd1.check(el) 验证当前项;
                    // 验证全部=>vd1.validate();

                    // 点击提交验证
                    $(".vd-btn", context).on("tap", function () {

                        // 是否验证成功
                        vd1.isSuccess(
                            // success
                            function (obj) {

                                vd1.reset();
                                $.mAlert(JSON.stringify(obj));

                            },
                            // error
                            function (obj) {

                                //console.log(obj);
                                $.mAlert(obj.errorMsg, function () { obj.el.focus(); });

                            });
                    });

                    // 发送验证码
                    $(".vd-dep-btn", context).click(function () {

                        // 根据name属性获取对象
                        if (vd1.getObj("phone").bl) {

                            $.mInfo("已发送验证码");
                        };

                    });

                    m("#city", context).focus(function () {
                        m(this).blur();
                        $.mPicker({ type: "city1" }, function (val) {
                            m(this).val(val.city.city1.txt);
                            vd1.check(this);
                        }.bind(this));
                    });

                    m("#router", context).tap(function () {
                      
                        m.router.link("./mr-test.html?name=hqs2&&age=38", {sex:"男"});

                    });

            },

            // 生命周期函数--监听页面显示
            onShow: function (context) {
               // context 当前路由模块上下文对
               console.log("onShow",context);
            },

             // 生命周期函数--监听页面隐藏
            onHide: function (context) {
                // context 当前路由模块上下文对
               console.log("onHide",context);
                m.router.app.page = (m.router.app.page - 1);

                },

        });

</script>


